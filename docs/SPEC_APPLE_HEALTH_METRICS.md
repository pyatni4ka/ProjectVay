# SPEC_APPLE_HEALTH_METRICS

## Какие метрики читаем

Обязательные:
- weight (масса тела)
- body fat %

Опциональные (если есть доступ):
- active energy
- nutrition consumption (kcal/protein/fat/carbs)
- steps/activity context

## Частота обновления

- Автоматически: 1 раз в день утром (при открытии приложения и в фоне, если разрешено системой).
- Ручное обновление: кнопка `Обновить из Apple Health` в настройках/экране метрик.
- Показываем `Last sync time`.

## Если данных нет

- Не блокируем пользователя.
- Мягко просим ручной ввод веса и % жира.
- До появления свежих данных используем последнее валидное значение.
- В UI прозрачно показываем, что расчет частично на ручных данных.

## Как ежедневно пересчитываются цели

- Weekly target задает общий коридор недели.
- Daily engine корректирует день по свежим данным (вес, % жира, фактическое потребление).
- Если был surplus/deficit, остаток недели выравнивается постепенно (smoothing), без резких скачков.
- Пересчет идет по per-meal targets, а не только по сумме дня.
