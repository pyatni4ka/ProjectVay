# DATA_RULES

## Зачем это нужно

Без нормализации продукты и рецепты выглядят как «разные», даже если это одно и то же. Из-за этого ломаются покупки, бюджет и точность макросов.

## 1) Нормализация ингредиентов (RU/EN)

- Приводим строки к нижнему регистру, убираем лишние символы.
- Сопоставляем с каноническим именем (например, `tomato`, `помидор`, `томаты` -> `tomato`).
- Храним:
  - `rawName`,
  - `canonicalName`,
  - `normalizationConfidence`.

## 2) Единицы измерения

Поддерживаем базовые единицы:
- mass: `g`, `kg`
- volume: `ml`, `l`
- count: `piece`

Конвертации:
- точные: g<->kg, ml<->l
- условные (piece->g) только если есть продуктовый коэффициент

Если коэффициента нет:
- не блокируем,
- ставим `approximate=true`,
- объясняем в UI.

## 3) Nutrition confidence

Для рецепта считаем `NutritionConfidence`:
- `high`: есть надежные nutrition + servings + валидные единицы
- `medium`: часть данных оценочная
- `low`: существенные пропуски

В strict macro режиме:
- `high` выше в ранжировании,
- `low` допускается только если иначе нет кандидатов.

## 4) Fallback правила

Если данных мало:
- используем ближайшие категории,
- добавляем warning,
- не ломаем основной сценарий «быстро собрать план».
