# Тест-план (Этап 1: Production MVP-инвентарь)

## 1) Unit (реализовано в `ios/Tests/InventoryCoreTests`)

### Database / Migrations
- Проверка создания таблиц: `products`, `batches`, `price_entries`, `inventory_events`, `app_settings`.
- Проверка индексов: `idx_products_barcode`, `idx_batches_expiry_date`, `idx_batches_location`, `idx_price_entries_product_date`, `idx_events_product_timestamp`.
- Проверка seed default настроек.

### Repository
- CRUD товара и партии.
- Поиск по инвентарю (name/brand/barcode) + фильтр по локации.
- Сохранение цены и сортировка истории цен по убыванию даты.

### NotificationScheduler
- Перенос напоминаний при quiet hours (обычное окно).
- Перенос при quiet hours через полночь.
- Пропуск напоминаний, попавших в прошлое.

## 2) Integration (обязательные сценарии)

- Добавление продукта с первичной партией создаёт:
  - `product` + `batch` в БД,
  - `inventory_event` типа `add`,
  - запланированные expiry-уведомления.
- Изменение `expiryDate` партии:
  - отменяет старые notification IDs,
  - создаёт новый набор актуальных уведомлений.
- Удаление партии:
  - удаляет запись,
  - удаляет pending/delivered уведомления.
- Завершение онбординга:
  - сохраняет настройки,
  - сохраняет `onboarding_completed = true`,
  - не показывает онбординг на следующем запуске.

## 3) UI сценарии (ручные)

### Онбординг
- Запрос уведомлений и корректный статус разрешения.
- Настройка quiet hours, шаблона 5/3/1, бюджета, магазинов, дизлайков.
- Переход в основное приложение после сохранения.

### Инвентарь
- Создание нового товара через `AddProductView`.
- Отображение партий отдельно в карточке товара.
- Редактирование и удаление партии через `EditBatchView`.
- Поиск по имени/бренду/штрихкоду и фильтр по зоне.

### Настройки
- Изменение quiet hours и шаблона дней.
- Изменение бюджетов, дизлайков и магазинов.
- Сохранение и повторная загрузка актуальных значений.

## 4) Acceptance checklist (из ТЗ, покрытие Этапа 1)

- Ручное добавление товара и партии выполняется в пределах 3-4 действий.
- Уведомления 5/3/1 не приходят в quiet hours.
- Изменение/удаление партии корректно перепланирует уведомления.
- Инвентарь, история и настройки полностью локальные (privacy by default).

## 5) Команды проверки

```bash
cd /Users/antonpyatnica/Downloads/ProjectVay/ios
swift test
```
